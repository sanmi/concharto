<?xml version="1.0" encoding="UTF-8"?>
<Module>
<ModulePrefs title="Concharto 80" 
                description="Test Concharto Maplet"
                author="Concharto.com"
                author_email="frank@concharto.com"
                height="150">
  <Require feature="sharedmap"/>
  <Require feature="opensocial-0.7"/>
</ModulePrefs>
<Content type="html"><![CDATA[

<form id="eventSearchForm">
Where: <input id="where" name="where" type="text" value="lala" size="22"/>
<input type="button" value="Search" onclick="doSearch()"/>
<br/>
<input id="limitWithinMapBounds1" name="limitWithinMapBounds" type="checkbox" value="true"/>
<input type="hidden" name="_limitWithinMapBounds" value="on"/>
Search current map shown.
<br/>
<input id="excludeTimeRangeOverlaps1" name="excludeTimeRangeOverlaps" type="checkbox" value="true"/>
<input type="hidden" name="_excludeTimeRangeOverlaps" value="on"/>
<input type="hidden" id="basePath" value="http://www.test.timespacemap.com/"/>

Find events that occurred only <em>within</em> the time frame specified.

</form>


<script src="http://www.test.timespacemap.com/javascript/prototype.js" type="text/javascript"/></script>
<script src="http://www.test.timespacemap.com/javascript/map.js?11" type="text/javascript"></script>
<script src="http://www.test.timespacemap.com/javascript/searchcommon.js?4" type="text/javascript"></script>
<script src="http://www.test.timespacemap.com/javascript/eventsearch.js?4" type="text/javascript"></script>


<script type="text/javascript">
  var _msg_newdiscuss = "Create a new discussion";
  var _msg_discuss = "Join the discussion";
  var _msg_edit = "Edit this event!";
  var _msg_changes = "View changes to this event";
  var _msg_flag = "Flag this event for administrator attention";
  var _msg_accy = new Array();
  _msg_accy[1] = 'Unspecified'; 
  _msg_accy[2] = 'Region'; 
  _msg_accy[3] = 'City'; 
  _msg_accy[4] = 'Neighborhood'; 
  _msg_accy[5] = 'Address'; 
  _msg_accy[6] = 'Pinpoint (+/- 10m)';
     

</script>    

<script type="text/javascript">
  
  //Setup a special map manager for maplets
  function MapletMapManager() {
    //initialize
    this.initializeMap = function(control) {
      initializeMapVars();
      // map and its equipment
      map = new GMap2();

      geocoder = new GClientGeocoder();
      //FSM DBEUG this.showDefault(); 
    }
    
    /* default map coordinates */
    this.showDefault = function() {    
      this.m_diagonal.getBoundsAsync(function(bounds) {
        map.setCenter(bounds.getCenter());  
        map.setZoom(map.getBoundsZoomLevel(bounds));
      });
    }
    
  }
  MapletMapManager.prototype = new MapManager();  //inherit with override
  _mapManager = new MapletMapManager();

  // Center the map in 
  var point = new GLatLng(37.71859, 6.679688);
  _mapManager.initializeMap();
  map.setCenter(new GLatLng(37, -122), 6);

  
  //Add some points
  var geo1 = "http://www.concharto.com/search/conchartosearch.kml?_what=inca&_zoom=13&_maptype=0&_kml=1";
  var geo2 = "http://www.test.timespacemap.com/search/conchartosearch.kml?_what=poly&_zoom=13&_maptype=0&_kml=1";
  var geo3 = "http://www.test.timespacemap.com:81/search/conchartosearch.kml?_what=poly&_withinMap=true&_zoom=13&_maptype=0&_kml=1";
  //var geoXml = new GGeoXml(geo2 + '&_rand=' + Math.random());

  //http://maps.google.com/maps/mm?ie=UTF8&hl=en&ll=37.125286,-122.124023&spn=10.889885,14.875488&t=p&z=6
  //map.addOverlay(geoXml);
  
  doSearch();
  
  //Load points from the server
  function doSearch(where, when, what) {
    alert(1);
    var url = "http://www.test.timespacemap.com/search/jsonsearch.htm?_what=%22poly+point%22";
    _IG_FetchContent(url, function(jsondata) {
        var events = jsondata.evalJSON();
        alert (events[0].summary );
        _overlayManager.createOverlays(events);
    });
  }
  
</script>

]]></Content>
</Module>
