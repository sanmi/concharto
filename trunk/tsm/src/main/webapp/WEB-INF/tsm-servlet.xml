<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN 2.0//EN"
        "http://www.springframework.org/dtd/spring-beans-2.0.dtd">
<beans>

	<!-- map controllers to URLs -->
	<bean class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
		<property name="interceptors">
			<list>
				<!-- so we can traverse hibernate lazy loaded collections, etc -->
				<ref bean="openSessionInViewInterceptor" /> 
			</list>
		</property>
		<property name="mappings">
			<props>
          <prop key="login.htm">loginController</prop>
          <prop key="home.htm">homeController</prop>
          <prop key="edit/event.htm">eventController</prop>
          <prop key="admin/signup.htm">signupController</prop>
          <prop key="member/settings.htm">settingsController</prop>
          
          <prop key="edit/changehistory.htm">changeHistoryController</prop>
          <prop key="member/contributions.htm">contributionsController</prop>

          <prop key="edit/flagevent.htm">flagEventController</prop>
          <prop key="edit/flageventsuccess.htm">flagEventController</prop>

          <prop key="search/eventsearch.htm">eventSearchController</prop>
          <prop key="search/embeddedsearch.htm">embeddedSearchController</prop>

          <prop key="logout.htm">switchBoardController</prop>
          <prop key="notauthorized.htm">switchBoardController</prop>
          <prop key="admin/listEvents.htm">switchBoardController</prop>
          <prop key="search/mapthumbnail.htm">switchBoardController</prop>
          <prop key="search/auditmapthumbnail.htm">switchBoardController</prop>

          <prop key="admin/flagdisposition.htm">eventDetailsController</prop>
          <prop key="edit/eventdetails.htm">eventDetailsController</prop>
          <prop key="edit/undoevent.htm">eventDetailsController</prop>
          
          <prop key="info/legal.htm">urlFilenameViewController</prop>
          <prop key="info/tour.htm">urlFilenameViewController</prop>
          <prop key="404.htm">urlFilenameViewController</prop>
          <prop key="500.htm">urlFilenameViewController</prop>
      </props>
		</property>		
	</bean>

	<!-- this bean with the well known name generates view names for us -->
	<!-- not strictly required since we just want to accept the defaults-->
	<bean id="viewNameTranslator"
		class="org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator" />

	<bean id="viewResolver"
		class="org.springframework.web.servlet.view.InternalResourceViewResolver">
		<property name="prefix" value="/WEB-INF/jsp/" />
		<property name="suffix" value=".jsp" />
	</bean>

	<bean id="baseEventController" abstract="true"></bean>

	<!-- Controller  -->
	<bean id="homeController" class="com.tech4d.tsm.web.home.HomeController">
		<property name="commandName" value="eventSearch" />
		<property name="commandClass" value="com.tech4d.tsm.web.eventsearch.EventSearchForm" />
		<property name="formView" value="home" />
		<property name="eventDao" ref="eventDao" />
	</bean>

	<bean id="urlFilenameViewController" class="org.springframework.web.servlet.mvc.UrlFilenameViewController"/>
	<bean id="switchBoardController" class="com.tech4d.tsm.web.SwitchBoardController" parent="baseEventController" >
		<property name="eventDao" ref="eventDao" />
		<property name="auditEntryDao" ref="auditEntryDao" />
	</bean>

	<bean id="eventDetailsController" class="com.tech4d.tsm.web.eventdetails.EventDetailsController" parent="baseEventController" >
		<property name="eventDao" ref="eventDao" />
		<property name="flagDao" ref="flagDao" />
		<property name="auditEntryDao" ref="auditEntryDao" />
		<property name="revertEventService" ref="revertEventService" />
	</bean>

	<bean id="loginFormValidator" class="com.tech4d.tsm.web.login.LoginFormValidator"/>
	<bean id="loginController" class="com.tech4d.tsm.web.login.LoginController" parent="baseEventController">
		<property name="commandName" value="login"/>
		<property name="commandClass" value="com.tech4d.tsm.web.login.LoginForm"/>
		<property name="formView" value="login" />
		<property name="successView" value="redirect:/" />
		<property name="validator" ref="loginFormValidator"/>
		<property name="userDao" ref="userDao"/>
	</bean>
	
	<bean id="signupFormValidator" class="com.tech4d.tsm.web.signup.SignupFormValidator">
		<property name="userDao" ref="userDao"/>
	</bean>
	<bean id="signupController" class="com.tech4d.tsm.web.signup.SignupController" parent="baseEventController">
		<property name="commandName" value="signup"/>
		<property name="commandClass" value="com.tech4d.tsm.web.signup.SignupForm"/>
		<property name="formView" value="admin/signup" />
		<property name="successView" value="redirect:/" />
		<property name="userDao" ref="userDao"/>
		<property name="validator" ref="signupFormValidator"/>
	</bean>
	
	<bean id="eventFormValidator" class="com.tech4d.tsm.web.edit.EventFormValidator"/>
	<bean id="eventController" class="com.tech4d.tsm.web.edit.EventController" parent="baseEventController">
		<property name="bindOnNewForm" value="true" />
		<property name="commandName" value="event" />
		<property name="commandClass" value="com.tech4d.tsm.web.edit.EventForm" />
		<property name="formView" value="edit/event" />
		<property name="successView" value="redirect:/search/eventsearch.htm" />
		<property name="eventDao" ref="eventDao" />
		<property name="validator" ref="eventFormValidator"/>
	</bean>

	<bean id="changeHistoryController" class="com.tech4d.tsm.web.changehistory.ChangeHistoryController" parent="baseEventController">
		<property name="formView" value="edit/changehistory" />
		<property name="auditEntryDao" ref="auditEntryDao" />
	</bean>
	<bean id="contributionsController" class="com.tech4d.tsm.web.changehistory.ChangeHistoryController" parent="baseEventController">
		<property name="formView" value="member/contributions" />
		<property name="pageSize" value="25"/>
		<property name="auditEntryDao" ref="auditEntryDao" />
	</bean>

	<bean id="eventSearchFormValidator" class="com.tech4d.tsm.web.eventsearch.EventSearchFormValidator"/>
	<bean id="eventSearchController" class="com.tech4d.tsm.web.eventsearch.EventSearchController" parent="baseEventController">
		<property name="commandName" value="eventSearch" />
		<property name="commandClass" value="com.tech4d.tsm.web.eventsearch.EventSearchForm" />
		<property name="formView" value="search/eventsearch" />
		<property name="successView" value="search/eventsearch" />
		<property name="eventSearchService" ref="eventSearchService" />
		<property name="validator" ref="eventSearchFormValidator"/>
	</bean>
	
	<bean id="embeddedSearchController" class="com.tech4d.tsm.web.eventsearch.EmbeddedSearchController" parent="baseEventController">
		<property name="commandName" value="eventSearch" />
		<property name="commandClass" value="com.tech4d.tsm.web.eventsearch.EventSearchForm" />
		<property name="formView" value="search/embeddedsearch" />
		<property name="successView" value="search/embeddedsearch" />
		<property name="eventSearchService" ref="eventSearchService" />
	</bean>

	<bean id="settingsFormValidator" class="com.tech4d.tsm.web.member.SettingsFormValidator"/>
	<bean id="settingsController" class="com.tech4d.tsm.web.member.SettingsController" parent="baseEventController">
		<property name="commandName" value="settings"/>
		<property name="commandClass" value="com.tech4d.tsm.web.member.SettingsForm"/>
		<property name="formView" value="member/settings" />
		<property name="successView" value="member/settings" />
		<property name="validator" ref="settingsFormValidator"/>
		<property name="userDao" ref="userDao"/>
	</bean>

	<bean id="flagEventFormValidator" class="com.tech4d.tsm.web.flagevent.FlagEventFormValidator"/>
	<bean id="flagEventController" class="com.tech4d.tsm.web.flagevent.FlagEventController" parent="baseEventController">
		<property name="commandName" value="flagEvent"/>
		<property name="commandClass" value="com.tech4d.tsm.web.flagevent.FlagEventForm"/>
		<property name="formView" value="edit/flagevent" />
		<property name="successView" value="edit/flageventsuccess" />
		<property name="validator" ref="flagEventFormValidator"/>
		<property name="userDao" ref="userDao"/>
		<property name="auditEntryDao" ref="auditEntryDao" />
		<property name="eventDao" ref="eventDao" />
		<property name="flagDao" ref="flagDao" />
	</bean>
	
</beans>
