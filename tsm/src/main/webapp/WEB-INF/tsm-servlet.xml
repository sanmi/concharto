<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN 2.0//EN"
        "http://www.springframework.org/dtd/spring-beans-2.0.dtd">
<beans>

	<!-- map controllers to URLs -->
	<bean class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
		<property name="interceptors">
			<list>
				<!-- so we can traverse hibernate lazy loaded collections, etc -->
				<ref bean="openSessionInViewInterceptor" /> 
			</list>
		</property>
		<property name="mappings">
			<props>
          <prop key="login.htm">loginController</prop>
          <prop key="logout.htm">switchBoardController</prop>
          <prop key="eventsearch.htm">eventSearchController</prop>
          <prop key="edit/event.htm">eventController</prop>
          <prop key="edit/changehistory.htm">changeHistoryController</prop>
          <prop key="admin/listEvents.htm">switchBoardController</prop>
      </props>
		</property>		
	</bean>

	<!-- this bean with the well known name generates view names for us -->
	<!-- not strictly required since we just want to accept the defaults-->
	<bean id="viewNameTranslator"
		class="org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator" />

	<bean id="viewResolver"
		class="org.springframework.web.servlet.view.InternalResourceViewResolver">
		<property name="prefix" value="/WEB-INF/jsp/" />
		<property name="suffix" value=".jsp" />
	</bean>

	<bean id="baseEventController" abstract="true"></bean>

	<!-- Controller names are not important when using the above HandlerMapping implementation -->
	<bean id="switchBoardController" class="com.tech4d.tsm.web.SwitchBoardController" parent="baseEventController" >
		<property name="eventDao" ref="eventDao" />
	</bean>

	<bean id="loginController" class="com.tech4d.tsm.web.login.LoginController" parent="baseEventController">
		<property name="commandName" value="login"/>
		<property name="commandClass" value="com.tech4d.tsm.web.login.LoginForm"/>
		<property name="formView" value="login" />
		<property name="successView" value="login" />
	</bean>
	
	<bean id="eventFormValidator" class="com.tech4d.tsm.web.util.EventFormValidator"/>
	<bean id="eventController" class="com.tech4d.tsm.web.EventController" parent="baseEventController">
		<property name="bindOnNewForm" value="true" />
		<property name="commandName" value="event" />
		<property name="commandClass" value="com.tech4d.tsm.web.EventForm" />
		<property name="formView" value="edit/event" />
		<property name="successView" value="redirect:/eventsearch.htm" />
		<property name="eventDao" ref="eventDao" />
		<property name="validator" ref="eventFormValidator"/>
	</bean>

	<bean id="changeHistoryController" class="com.tech4d.tsm.web.ChangeHistoryController" parent="baseEventController">
		<property name="commandName" value="changeHistory"/>
		<property name="commandClass" value="com.tech4d.tsm.web.ChangeHistoryForm"/>
		<property name="formView" value="edit/changehistory" />
		<property name="successView" value="edit/changehistory" />
		<property name="auditEntryDao" ref="auditEntryDao" />
	</bean>

	<bean id="eventSearchFormValidator" class="com.tech4d.tsm.web.util.EventSearchFormValidator"/>
	<bean id="eventSearchController" class="com.tech4d.tsm.web.EventSearchController" parent="baseEventController">
		<property name="commandName" value="eventSearch" />
		<property name="commandClass" value="com.tech4d.tsm.web.EventSearchForm" />
		<property name="formView" value="eventsearch" />
		<property name="successView" value="eventsearch" />
		<property name="eventSearchService" ref="eventSearchService" />
		<property name="validator" ref="eventSearchFormValidator"/>
	</bean>

</beans>
